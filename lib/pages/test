// GANTI SELURUH GRIDVIEW.BUILDER ANDA DENGAN KODE INI
GridView.builder(
  shrinkWrap: true,
  physics: const NeverScrollableScrollPhysics(),
  itemCount: displayProducts.length,
  // 1. Ganti GridDelegate agar responsif di Laptop & HP
  gridDelegate: const SliverGridDelegateWithMaxCrossAxisExtent(
    maxCrossAxisExtent: 220, // Lebar kartu maksimal 220px agar tidak melar di Web
    mainAxisSpacing: 15,
    crossAxisSpacing: 15,
    childAspectRatio: 0.75, // Menjaga proporsi kartu tetap kotak/tegak
  ),
  itemBuilder: (context, index) {
    final p = displayProducts[index];
    final liked = widget.appState.value.wishlist.contains(p.id);

    return GestureDetector(
      onTap: () {
        showDialog(
          context: context,
          builder: (_) => DetailDialog(
            product: p,
            appState: widget.appState,
            onAppStateChanged: widget.onAppStateChanged,
            currency: widget.currency,
          ),
        );
      },
      child: Container(
        decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(12),
          border: Border.all(
              color: darkMode ? Colors.white12 : Colors.grey.shade300),
          color: cardColor,
          boxShadow: [
            if (!darkMode)
              BoxShadow(color: Colors.grey.shade200, blurRadius: 5)
          ],
        ),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start, // Pastikan teks rata kiri
          children: [
            Expanded(
              child: Stack(
                children: [
                  Positioned.fill(
                    child: ClipRRect(
                      borderRadius: const BorderRadius.vertical(top: Radius.circular(12)),
                      child: Image.asset(
                        p.image,
                        fit: BoxFit.cover,
                        errorBuilder: (context, error, stackTrace) =>
                            Container(
                          color: Colors.grey,
                          child: const Center(child: Icon(Icons.broken_image)),
                        ),
                      ),
                    ),
                  ),
                  // Overlay SOLD OUT
                  if (p.isSold)
                    Positioned.fill(
                      child: Container(
                        decoration: BoxDecoration(
                          color: Colors.black.withOpacity(0.65),
                          borderRadius: const BorderRadius.vertical(top: Radius.circular(12)),
                        ),
                        child: Center(
                          child: Transform.rotate(
                            angle: -0.2,
                            child: Container(
                              padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 5),
                              decoration: BoxDecoration(
                                border: Border.all(color: Colors.red, width: 2.5),
                                borderRadius: BorderRadius.circular(4),
                              ),
                              child: const Text(
                                "SOLD OUT",
                                style: TextStyle(
                                  color: Colors.red,
                                  fontWeight: FontWeight.bold,
                                  fontSize: 16, // Ukuran font disesuaikan
                                  letterSpacing: 1.2,
                                ),
                              ),
                            ),
                          ),
                        ),
                      ),
                    ),
                ],
              ),
            ),
            // Informasi Produk di bawah gambar
            Padding(
              padding: const EdgeInsets.all(10),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    p.name,
                    maxLines: 1,
                    overflow: TextOverflow.ellipsis,
                    style: TextStyle(
                        fontSize: 13,
                        fontWeight: FontWeight.bold,
                        color: primaryTextColor,
                        decoration: p.isSold ? TextDecoration.lineThrough : null),
                  ),
                  const SizedBox(height: 5),
                  Text(
                    widget.currency.format(p.price),
                    style: TextStyle(
                        fontSize: 12,
                        fontWeight: FontWeight.bold,
                        color: p.isSold ? Colors.grey : Colors.green),
                  ),
                ],
              ),
            )
          ],
        ),
      ),
    );
  },
)